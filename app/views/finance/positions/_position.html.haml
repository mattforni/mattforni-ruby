-# Initialize other variables
- stop = position.stop

-# Render the position row
%tr.position.visible{class: ((index+1)%2).odd? ? 'odd' : 'even', id: position.symbol}
  %td
    = position.symbol
  %td.number-cell
    = currency_display position.last_trade
  %td.number-cell
    = decimal_display position.quantity, 1
  %td.number-cell
    = currency_display position.current_value
  %td.number-cell
    = currency_display position.lowest_price
  %td.number-cell
    = currency_display position.highest_price
  %td.right
    - if !stop.nil?
      = link_to "#{currency_display stop.stop_price}", finance_stop_path(stop.id)
    - else
      = link_to 'Stop', new_finance_stop_path(symbol: position.symbol) if can?(:create, Stop)

-# Render the holdings associated with this position
- position.holdings.each_with_index do |holding, index|
  = holding_partial holding, index

-# TODO use to delete holdings
  = link_to 'X', finance_holding_path(holding.id), data: {confirm: 'You sure?'}, method: :delete if can?(:destroy, holding)

